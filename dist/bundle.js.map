{"version":3,"sources":["webpack:///webpack/bootstrap 767e44159a98298d9258","webpack:///./src/image-cache.js","webpack:///./src/cell.js","webpack:///./src/index.js","webpack:///./src/game.js","webpack:///./src/grid.js","webpack:///./src/coord.js","webpack:///./src/tower.js","webpack:///./src/goon.js","webpack:///./src/path-finder.js","webpack:///./src/renderer.js"],"names":["loadImageCache","imageUrls","imageCache","onLoadComplete","key","url","img","Image","onload","Object","keys","length","src","CELL_EDGE_SIZE","Cell","row","col","coord","reachable","dist","undefined","nextStep","blocked","equals","x","Math","round","y","pointInCell","zero","getTopLeftPosition","init","canvas","document","getElementById","game","renderer","start","initCtrlPanel","onclick","e","stopPropagation","preventDefault","value","spawnGoon","Game","grid","width","height","pathFinder","towers","goons","highlight","spawnedGoons","intervalId","window","setInterval","spawnGoons","bind","position","towerCells","getCellsAround","rows","cols","some","cell","hasGoon","forEach","recalculate","goonCells","map","goon","trapped","towerBoundaries","_getCellsBoudaries","tower","push","mousePosition","isOcuppied","boundaries","valid","NUMBER_OF_GOONS_TO_SPAWN","floor","random","rowCount","clearInterval","spawnCell","get","id","Date","now","index","findIndex","aGoon","splice","delta","update","updateHighlight","cells","topLeft","bottomRight","getBottomRightPosition","Grid","canvasSize","colCount","Array","allCells","concat","apply","any","filter","_isOutOfGrid","point","topLeftCell","getCellAtPosition","bottomRightCell","center","topRow","bottomRow","leftCol","rightCol","Coord","TOWER_SIZE","Tower","topLeftPosition","context","fillStyle","strokeStyle","fillRect","strokeRect","bottomRightPosition","Goon","initialCell","speed","_residualStep","drawImage","nextCell","removeGoon","offset","getOffset","targetPosition","step","intStep","nextPosition","calculateNextPosition","nextPositionCell","current","target","stepSize","dx","dy","hyp","sqrt","pow","sin","cos","dyStep","dxStep","nextX","nextY","PathFinder","reset","targetCell","getTarget","frontier","shift","neighboursCells","getUnvisitedNeighboursCells","neighbourCell","currentCell","steps","Renderer","getContext","onCanvasClick","onmousemove","onMouseMove","onmouseout","lastTick","animationId","requestAnimationFrame","tick","render","clearRect","stroke","fill","_paintBoundaries","draw","blockedCells","getCells","getBoundaries","event","clientX","offsetLeft","clientY","offsetTop","onUserClick","w","h"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 767e44159a98298d9258","/* global Image */\n\n/**\n * List of images to load.\n * @type {Object}\n */\nconst imageUrls = {\n  'tower-1': '../images/tower-1.png',\n  'goon-1': '../images/goon-1.png'\n}\n\n/**\n * Global image cache.\n * @type {Object}\n */\nexport const imageCache = {}\n\n/**\n * Load the images on the cache and call the callback when ready.\n * @param  {function} onLoadComplete\n */\nexport function loadImageCache (onLoadComplete) {\n  for (let key in imageUrls) {\n    let url = imageUrls[key]\n    let img = new Image()\n    img.onload = () => {\n      imageCache[key] = img\n      if (Object.keys(imageCache).length === Object.keys(imageUrls).length) {\n        onLoadComplete()\n      }\n    }\n    img.src = url\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/image-cache.js","/**\n * @typedef {Object} Point\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n */\n\nimport Coord from './coord'\n\n/**\n * Size of the (square) cell edge.\n * @type {number}\n */\nexport const CELL_EDGE_SIZE = 20\n\n/**\n * Grid cell.\n */\nexport class Cell {\n  /**\n   * @param {number} row - Row number.\n   * @param {number} col - Column number.\n   */\n  constructor (row, col) {\n    this.coord = new Coord(row, col)\n    this.reachable = false\n    this.dist = undefined\n    this.nextStep = undefined\n    this.blocked = false\n  }\n\n  /**\n   * Check cell coordinates.\n   * @param {Coord} coord\n   * @return {Boolean}\n   */\n  isOnCoord (coord) {\n    return this.coord.equals(coord)\n  }\n\n  /**\n   * Get the position of the center of the cell in pixels.\n   * @return {Point}\n   */\n  getCenterPosition () {\n    let x = Math.round((this.coord.col * CELL_EDGE_SIZE) + (CELL_EDGE_SIZE / 2))\n    let y = Math.round((this.coord.row * CELL_EDGE_SIZE) + (CELL_EDGE_SIZE / 2))\n    return {x, y}\n  }\n\n  /**\n   * Get the top-left position of the cell in pixels.\n   * @return {Point}\n   */\n  getTopLeftPosition () {\n    let x = this.coord.col * CELL_EDGE_SIZE\n    let y = this.coord.row * CELL_EDGE_SIZE\n    return {x, y}\n  }\n\n  /**\n   * Get the bottom-right position of the cell in pixels.\n   * @return {Point}\n   */\n  getBottomRightPosition () {\n    let x = (this.coord.col + 1) * CELL_EDGE_SIZE\n    let y = (this.coord.row + 1) * CELL_EDGE_SIZE\n    return {x, y}\n  }\n\n  /**\n   * Get the offset of a point inside the cell from the cell's top-left corner.\n   * @param  {Point} pointInCell\n   * @return {Point} offset\n   */\n  getOffset (pointInCell) {\n    const zero = this.getTopLeftPosition()\n    return {\n      x: pointInCell.x - zero.x,\n      y: pointInCell.y - zero.y\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cell.js","import {loadImageCache} from './image-cache.js'\nimport Game from './game.js'\nimport Renderer from './renderer.js'\n\nloadImageCache(init)\n\nfunction init () {\n  const canvas = document.getElementById('canvas')\n  const game = new Game()\n  const renderer = new Renderer(canvas, game)\n  renderer.start()\n  initCtrlPanel(game)\n}\n\nfunction initCtrlPanel (game) {\n  document.getElementById('spawn').onclick = function (e) {\n    e.stopPropagation()\n    e.preventDefault()\n\n    const x = document.getElementById('x').value\n    const y = document.getElementById('y').value\n    game.spawnGoon(x, y)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","/**\n * @typedef {Object} Point\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n */\n\nimport Grid from './grid'\nimport {Tower, TOWER_SIZE} from './tower'\nimport Goon from './goon'\nimport PathFinder from './path-finder'\n\nexport default class Game {\n  constructor () {\n    this.grid = new Grid({width: 1000, height: 600})\n    this.pathFinder = new PathFinder(this.grid)\n    this.towers = []\n    this.goons = []\n    this.highlight = undefined\n    this.spawnedGoons = 0\n\n    this.intervalId = window.setInterval(this.spawnGoons.bind(this), 800)\n  }\n\n  /**\n   * When a user click a cell.\n   * @param  {Point} position - Cell upper-left position.\n   */\n  onUserClick (position) {\n    const towerCells = this.grid.getCellsAround(position, TOWER_SIZE.rows, TOWER_SIZE.cols)\n    // occupied ?\n    if (!towerCells || towerCells.some(cell => cell.blocked || cell.hasGoon)) {\n      return\n    }\n    // 1: block\n    towerCells.forEach(cell => { cell.blocked = true })\n    // 2: recalculate paths\n    this.pathFinder.recalculate()\n    // 3: check if there is any goon trapped\n    const goonCells = this.goons.map(goon => goon.cell)\n    // TODO: check the spawn locations as well\n    const trapped = goonCells.some(cell => !cell.reachable)\n    // 4: if trapped, rollback\n    if (trapped) {\n      towerCells.forEach(cell => { cell.blocked = false })\n      this.pathFinder.recalculate()\n      return\n    }\n\n    const towerBoundaries = this._getCellsBoudaries(towerCells)\n    const tower = new Tower(towerBoundaries)\n    this.towers.push(tower)\n  }\n\n  onMouseMove (position) {\n    this.mousePosition = position\n  }\n\n  updateHighlight () {\n    if (!this.mousePosition) {\n      return\n    }\n    const towerCells = this.grid.getCellsAround(this.mousePosition, TOWER_SIZE.rows, TOWER_SIZE.cols)\n    if (!towerCells) {\n      this.highlight = undefined\n      return\n    }\n    const towerBoundaries = this._getCellsBoudaries(towerCells)\n    const isOcuppied = towerCells.some(cell => cell.blocked || cell.hasGoon)\n    this.highlight = {\n      boundaries: towerBoundaries,\n      valid: !isOcuppied\n    }\n  }\n\n  /**\n   * Spawn a new goon.\n   */\n  spawnGoons () {\n    const NUMBER_OF_GOONS_TO_SPAWN = 10\n    // TODO: Use fixed spawn locations\n    const row = Math.floor(Math.random() * this.grid.rowCount)\n    const col = 0\n    this.spawnGoon(row, col)\n    if (++this.spawnedGoons >= NUMBER_OF_GOONS_TO_SPAWN) {\n      window.clearInterval(this.intervalId)\n    }\n  }\n\n  spawnGoon (row, col) {\n    const spawnCell = this.grid.get(row, col)\n    const id = Date.now()\n    const goon = new Goon(id, spawnCell, this, this.pathFinder)\n    this.goons.push(goon)\n  }\n\n  removeGoon (goon) {\n    const index = this.goons.findIndex((aGoon) => aGoon.id === goon.id)\n    if (index >= 0) {\n      this.goons.splice(index, 1)\n    }\n  }\n\n  /**\n   * Update the state of the game entities.\n   * @param  {number} delta - ms since last update.\n   */\n  update (delta) {\n    this.goons.forEach((goon) => goon.update(delta))\n    this.updateHighlight()\n  }\n\n  _getCellsBoudaries (cells) {\n    return {\n      topLeft: cells[0].getTopLeftPosition(),\n      bottomRight: cells[cells.length - 1].getBottomRightPosition()\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/game.js","/**\n * @typedef {Object} CellData\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n * @property {number} dist - Number of steps until target.\n * @property {number} nextStep - Next cell on the path to target.\n */\n\nimport {Cell, CELL_EDGE_SIZE} from './cell'\n\nexport default class Grid {\n  constructor (canvasSize) {\n    this.canvasSize = canvasSize\n    this.colCount = Math.floor(canvasSize.width / CELL_EDGE_SIZE)\n    this.rowCount = Math.floor(canvasSize.height / CELL_EDGE_SIZE)\n    this.init()\n  }\n\n  init () {\n    this.grid = new Array(this.rowCount)\n    for (var row = 0; row < this.rowCount; row++) {\n      this.grid[row] = Array(this.colCount)\n      for (var col = 0; col < this.colCount; col++) {\n        this.grid[row][col] = new Cell(row, col)\n      }\n    }\n    // flatten all cells on a single array\n    this.allCells = [].concat.apply([], this.grid)\n  }\n\n  /**\n   * Reset grid data.\n   */\n  reset () {\n    for (var row = 0; row < this.rowCount; row++) {\n      for (var col = 0; col < this.colCount; col++) {\n        this.grid[row][col].reachable = false\n        this.grid[row][col].dist = undefined\n        this.grid[row][col].nextStep = undefined\n      }\n    }\n  }\n\n  /**\n   * Get cell at position.\n   * @param  {number} x - X coordinate.\n   * @param  {number} y - Y coordinate.\n   * @return {Cell}\n   */\n  get (row, col) {\n    try {\n      return this.grid[row][col]\n    } catch (any) {\n      return undefined\n    }\n  }\n\n  /**\n   * Get target cell.\n   * @return {Cell}\n   */\n  getTarget () {\n    let row = Math.round(this.rowCount / 2)\n    let col = this.colCount - 1\n    return this.get(row, col)\n  }\n\n  /**\n   * Get the unvisited neighbour cells of the position.\n   * @param  {Cell} cell\n   * @return {Cell[]}\n   */\n  getUnvisitedNeighboursCells (cell) {\n    const coord = cell.coord\n    const grid = this\n    return [\n      {row: coord.row, col: coord.col - 1},\n      {row: coord.row - 1, col: coord.col},\n      {row: coord.row, col: coord.col + 1},\n      {row: coord.row + 1, col: coord.col}\n    ].filter(coord => (\n      !this._isOutOfGrid(coord)\n    )).map(coord => (\n      grid.get(coord.row, coord.col)\n    )).filter(cell => (\n      cell.dist === undefined &&\n      !cell.blocked\n    ))\n  }\n\n  /**\n   * Get the cell that contains the provided position.\n   * @param  {Point} point\n   * @return {Cell}\n   */\n  getCellAtPosition (point) {\n    if (point.x < 0 ||\n      point.x > this.canvasSize.width ||\n      point.y < 0 ||\n      point.y > this.canvasSize.height\n    ) {\n      return undefined\n    }\n    const col = Math.floor(point.x / CELL_EDGE_SIZE)\n    const row = Math.floor(point.y / CELL_EDGE_SIZE)\n    return this.get(row, col)\n  }\n\n  /**\n   * Get the cells that contains the boundaries area.\n   * @param  {Boundaries} boundaries\n   * @return {Cell[]}\n   */\n  getCellsInBoundaries (boundaries) {\n    const topLeftCell = this.getCellAtPosition(boundaries.topLeft)\n    const bottomRightCell = this.getCellAtPosition(boundaries.bottomRight)\n    const cells = []\n    for (let row = topLeftCell.coord.row; row <= bottomRightCell.coord.row; row++) {\n      for (let col = topLeftCell.coord.col; col <= bottomRightCell.coord.col; col++) {\n        cells.push(this.get(row, col))\n      }\n    }\n    return cells\n  }\n\n  /**\n   * Return an array containing all cells.\n   * @return {Cell[]}\n   */\n  getCells () {\n    return this.allCells\n  }\n\n  /**\n   * Return a block of cells containg the point approximately in the center\n   * @param  {Point} point - Point contained in the block,\n   * @param  {number} rowCount - Number of rows in the block.\n   * @param  {number} colCount - Number of cols in the block.\n   * @return {Cell[]}\n   */\n  getCellsAround (point, rowCount, colCount) {\n    const center = this.getCellAtPosition(point)\n    if (!center) {\n      return undefined\n    }\n    const topRow = center.coord.row - Math.floor(rowCount / 2)\n    const bottomRow = topRow + rowCount - 1\n    const leftCol = center.coord.col - Math.floor(colCount / 2)\n    const rightCol = leftCol + colCount - 1\n    if (this._isOutOfGrid({row: topRow, col: leftCol}) ||\n      this._isOutOfGrid({row: bottomRow, col: rightCol})) {\n      return undefined\n    }\n\n    const cells = []\n    for (let row = topRow; row <= bottomRow; row++) {\n      for (let col = leftCol; col <= rightCol; col++) {\n        cells.push(this.get(row, col))\n      }\n    }\n    return cells\n  }\n\n  /**\n   * Check if a coordinate is out of the grid.\n   * @param  {Coord} coord\n   * @return {Boolean}       [description]\n   */\n  _isOutOfGrid (coord) {\n    return coord.col < 0 ||\n      coord.col >= this.colCount ||\n      coord.row < 0 ||\n      coord.row >= this.rowCount\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/grid.js","export default class Coord {\n  /**\n   * @param {number} row\n   * @param {number} col\n   */\n  constructor (row, col) {\n    this.row = row\n    this.col = col\n  }\n\n  /**\n   * Compare two coordinates.\n   * @param {Coord} coord\n   * @return {Boolean}\n   */\n  equals (coord) {\n    return coord && this.row === coord.row && this.col === coord.col\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/coord.js","/**\n * @typedef {Object} Point\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n */\n\n/**\n * @typedef {Object} Boundaries\n * @property {Point} topLeft - top-left point of the object.\n * @property {Point} bottomRight - bottom-right point of the object.\n */\nexport const TOWER_SIZE = {\n  rows: 2,\n  cols: 2\n}\n\nexport class Tower {\n  constructor (boundaries) {\n    this.topLeftPosition = boundaries.topLeft\n    this.width = boundaries.bottomRight.x - boundaries.topLeft.x\n    this.height = boundaries.bottomRight.y - boundaries.topLeft.y\n  }\n\n  /**\n   * Draw the tower on position.\n   * @param  {CanvasRenderingContext2D} context - Canvas renderering context.\n   */\n  draw (context) {\n    context.fillStyle = 'lightgray'\n    context.strokeStyle = 'dimgray'\n    context.fillRect(this.topLeftPosition.x, this.topLeftPosition.y, this.width, this.height)\n    context.strokeRect(this.topLeftPosition.x, this.topLeftPosition.y, this.width, this.height)\n  }\n\n  /**\n   * Get to top-left and bottom-right points of the tower.\n   * @return {Boundaries}\n   */\n  getBoundaries () {\n    return {\n      'topLeft': this.topLeftPosition,\n      'bottomRight': this.bottomRightPosition\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tower.js","import {imageCache} from './image-cache.js'\n\nexport default class Goon {\n  constructor (id, initialCell, game, pathFinder) {\n    this.id = id\n    this.game = game\n    this.pathFinder = pathFinder\n    this.cell = initialCell\n    this.cell.hasGoon = true\n    this.position = this.cell.getTopLeftPosition()\n    this.speed = 20 // px/sec\n\n    this._residualStep = 0\n  }\n\n  /**\n   * Draw the goon on position.\n   * @param  {CanvasRenderingContext2D} context - Canvas renderering context.\n   */\n  draw (context) {\n    var img = imageCache['goon-1']\n    context.drawImage(img, this.position.x, this.position.y)\n  }\n\n  /**\n   * Update goon state.\n   * @param  {number} delta - ms since last update.\n   */\n  update (delta) {\n    this.cell.hasGoon = false\n    const nextCell = this.pathFinder.nextCell(this.cell, 1)\n    if (!nextCell) {\n      this.game.removeGoon(this)\n      return\n    }\n\n    const offset = this.cell.getOffset(this.position)\n    const targetPosition = {\n      x: nextCell.getTopLeftPosition().x + offset.x,\n      y: nextCell.getTopLeftPosition().y + offset.y\n    }\n\n    const step = (this.speed * delta / 1000.0) + this._residualStep\n    const intStep = Math.floor(step)\n    this._residualStep = step - intStep\n\n    const nextPosition = this.calculateNextPosition(this.position, targetPosition, intStep)\n    // Might happen that step is not enought to change cell\n    const nextPositionCell = this.game.grid.getCellAtPosition(nextPosition)\n\n    if (nextPositionCell) {\n      this.cell = nextPositionCell\n      this.cell.hasGoon = true\n      this.position = nextPosition\n    } else {\n      this.game.removeGoon(this)\n    }\n  }\n\n  /**\n   * Given the current and target position and the size of a step, calculate the new position after one step.\n   * @param  {Point} current - Current position.\n   * @param  {Point} target - Target position.\n   * @param  {number} stepSize - Size of the step (in pixels).\n   * @return {Point} Position after one step.\n   */\n  calculateNextPosition (current, target, stepSize) {\n    // TODO: check this logic for negative dy\n    const dx = target.x - current.x\n    const dy = target.y - current.y\n    const hyp = Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2))\n    const sin = dy / hyp\n    const cos = dx / hyp\n\n    const dyStep = sin * stepSize\n    const dxStep = cos * stepSize\n\n    const nextX = current.x + dxStep\n    const nextY = current.y + dyStep\n    return {x: nextX, y: nextY}\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/goon.js","\nexport default class PathFinder {\n  constructor (grid) {\n    this.grid = grid\n    this.recalculate()\n  }\n\n  /**\n   * Recalculate all paths\n   */\n  recalculate () {\n    this.grid.reset()\n    let targetCell = this.grid.getTarget()\n    targetCell.dist = 0\n    targetCell.reachable = true\n    targetCell.nextStep = undefined\n    this.frontier = [targetCell]\n\n    while (this.frontier.length > 0) {\n      let current = this.frontier.shift()\n      let neighboursCells = this.grid.getUnvisitedNeighboursCells(current)\n      for (let neighbourCell of neighboursCells) {\n        neighbourCell.dist = current.dist + 1\n        neighbourCell.reachable = true\n        neighbourCell.nextStep = current\n        this.frontier.push(neighbourCell)\n      }\n    }\n  }\n\n  /**\n   * Get the next position in the path to the target.\n   * @param  {Point} currentPosition - Current position.\n   * @param  {Number} steps - Number of steps to perform.\n   * @return {Point}\n   */\n  nextCell (currentCell, steps = 1) {\n    let nextCell = currentCell.nextStep\n    while (--steps > 0 && nextCell) {\n      nextCell = nextCell.nextStep\n    }\n    return nextCell\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/path-finder.js","/* global requestAnimationFrame */\n\n/**\n * @typedef {Object} Point\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n */\n\nimport {CELL_EDGE_SIZE} from './cell'\n\nclass Renderer {\n  /**\n   * Grid constructor\n   * @param  {HTMLCanvasElement} canvas - HTML canvas.\n   */\n  constructor (canvas, game) {\n    this.canvas = canvas\n    this.game = game\n    this.canvas.width = this.game.grid.canvasSize.width\n    this.canvas.height = this.game.grid.canvasSize.height\n    this.context = this.canvas.getContext('2d')\n\n    // bind events\n    this.canvas.onclick = this.onCanvasClick.bind(this)\n    this.canvas.onmousemove = this.onMouseMove.bind(this)\n    this.canvas.onmouseout = this.onMouseMove.bind(this)\n  }\n\n  /**\n   * Start the game loop.\n   */\n  start () {\n    this.lastTick = Date.now()\n    this.animationId = requestAnimationFrame(this.tick.bind(this))\n  }\n\n  /**\n   * Update state, render and restart the game loop every X ms.\n   */\n  tick () {\n    const now = Date.now()\n    const delta = (now - this.lastTick)\n\n    this.game.update(delta)\n    this.lastTick = now\n\n    this.render()\n    this.animationId = requestAnimationFrame(this.tick.bind(this))\n  }\n\n  /**\n   * Draw the grid.\n   */\n  render () {\n    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    // 0: highlight\n    if (this.game.highlight) {\n      let stroke = 'green'\n      let fill = 'lightgreen'\n      if (!this.game.highlight.valid) {\n        stroke = 'red'\n        fill = 'lightcoral'\n      }\n      this._paintBoundaries(this.game.highlight.boundaries, stroke, fill)\n    }\n\n    // 1st layer: towers\n    this.game.towers.forEach((tower) => {\n      tower.draw(this.context)\n    })\n\n    // 2nd layer: goons\n    this.game.goons.forEach((goon) => {\n      goon.draw(this.context)\n    })\n  }\n\n  /**\n   * DEBUG: paint a blue square on blocked cells\n   */\n  paintBlockedCells () {\n    this.context.fillStyle = 'lightskyblue'\n    this.context.strokeStyle = 'azure'\n    const blockedCells = this.game.grid.getCells().filter((cell) => cell.blocked)\n    blockedCells.forEach((cell) => {\n      let position = cell.getTopLeftPosition()\n      this.context.strokeRect(position.x, position.y, CELL_EDGE_SIZE, CELL_EDGE_SIZE)\n      this.context.fillRect(position.x, position.y, CELL_EDGE_SIZE, CELL_EDGE_SIZE)\n    })\n\n    this.game.towers.forEach((tower) => {\n      this._paintBoundaries(tower.getBoundaries(), 'red')\n    })\n  }\n\n  /**\n   * Trigger onclick on canvas click.\n   * @param {MouseEvent} event\n   */\n  onCanvasClick (event) {\n    var mousePosition = {\n      x: event.clientX - event.target.offsetLeft,\n      y: event.clientY - event.target.offsetTop\n    }\n    this.game.onUserClick(mousePosition)\n  }\n\n  onMouseMove (event) {\n    var mousePosition = {\n      x: event.clientX - event.target.offsetLeft,\n      y: event.clientY - event.target.offsetTop\n    }\n    this.game.onMouseMove(mousePosition)\n  }\n\n  _paintBoundaries (boundaries, stroke, fill) {\n    let position = boundaries.topLeft\n    let w = boundaries.bottomRight.x - position.x\n    let h = boundaries.bottomRight.y - position.y\n    if (stroke) {\n      this.context.strokeStyle = stroke\n      this.context.strokeRect(position.x, position.y, w, h)\n    }\n    if (fill) {\n      this.context.fillStyle = fill\n      this.context.fillRect(position.x, position.y, w, h)\n    }\n  }\n}\n\nexport default Renderer\n\n\n\n// WEBPACK FOOTER //\n// ./src/renderer.js"],"sourceRoot":""}