{"version":3,"sources":["webpack:///webpack/bootstrap d0314ad734240342be90","webpack:///./src/game.js","webpack:///./src/image-cache.js","webpack:///./src/geometry-utils.js","webpack:///./src/drawing-utils.js","webpack:///./src/cell.js","webpack:///./src/game-config.js","webpack:///./src/goon.js","webpack:///./src/utils/random.js","webpack:///./src/grid.js","webpack:///./src/coord.js","webpack:///./src/tower.js","webpack:///./src/bullet.js","webpack:///./src/goon-wave.js","webpack:///./src/path-finder.js","webpack:///./src/score-board.js","webpack:///./src/renderer.js","webpack:///./src/index.js"],"names":["initGame","getGame","gameSingleton","canvas","scoreBoard","Game","Error","towers","goons","bullets","highlight","undefined","spawnedGoonCount","cash","initialCash","goonsInside","_isPaused","grid","width","height","pathFinder","goonWave","renderer","cellsWhereGoonCanSpawn","getCellsWhereGoonCanSpawn","gameInitialized","_init","start","stop","won","updateMessage","wavesEnded","position","cost","towerCells","getCellsAround","sizeInCells","rows","cols","some","cell","blocked","hasGoon","forEach","recalculate","doNotTrapCells","map","goon","concat","isInvalidPosition","reachable","towerBoundaries","_getCellsBoudaries","tower","push","mousePosition","isOcuppied","boundaries","valid","spawnCell","getRandomElementFromArray","setInitialCell","bounty","removeGoon","endGame","index","findIndex","aGoon","id","splice","length","bullet","aBullet","delta","update","updateHighlight","middle","Math","round","rowCount","count","min","row","cells","get","topLeft","getTopLeftPosition","bottomRight","getBottomRightPosition","loadImageCache","imageUrls","imageCache","onLoadComplete","key","url","img","Image","onload","Object","keys","src","calculateDistance","pointA","pointB","dx","x","dy","y","sqrt","pow","getPointInLine","origin","secondPointInLine","distance","maxOnSecondPoint","hyp","sin","cos","dyStep","dxStep","abs","nextX","nextY","getAngleRadians","asin","isEqualPoints","tolerance","buildSquarePath","roundRect","circle","polygon","startPosition","edgeSize","path","Path2D","startCorner","corners","moveTo","corner","lineTo","ctx","fill","stroke","radius","tl","tr","br","bl","defaultRadius","side","beginPath","quadraticCurveTo","closePath","arc","PI","CELL_EDGE_SIZE","Cell","col","coord","dist","nextStep","isTarget","equals","pointInCell","zero","waves","intervalAfterWave","numberOfGoons","intervalBetweenSpawns","goonSpeed","goonLife","goonBounty","GOON_IMAGE_SIZE","Goon","speed","life","game","fullLife","_residualStep","context","drawImage","drawLifeBar","greenWidth","max","redWidth","greenX","redX","fillStyle","fillRect","updatePosition","updateLife","killGoon","nextCell","offset","getOffset","targetPosition","step","intStep","floor","nextPosition","nextPositionCell","getCellAtPosition","goonArrived","Random","yesChance","random","ceil","array","getRandomIntExclusive","currentIndex","temporaryValue","randomIndex","Grid","canvasSize","colCount","init","Array","allCells","apply","any","filter","_isOutOfGrid","point","topLeftCell","bottomRightCell","center","topRow","bottomRow","leftCol","rightCol","strokeStyle","strokeRect","Coord","Tower","topLeftPosition","centerPosition","reloadTime","fireRange","damage","timeUntilReloaded","canonAngle","basePct","baseWidth","baseHeight","baseX","baseY","rotPct","rotRadius","rotCenterX","rotCenterY","canonPct","canonWidth","canonHeight","canonX","canonY","save","translate","rotate","restore","isLoaded","shoot","reload","getClosestGoonInRange","addBullet","towerCenter","goonsInRange","goonDist","sort","a","b","bottomRightPosition","SPEED","RADIUS","Bullet","initialPosition","targetGoon","Date","now","target","removeBullet","GoonWave","config","slice","currentWave","waveNumber","timeUntilNexWave","timeUntilNextSpawn","goonsLeft","startOrStopWave","deployGoons","onWavesEnd","shift","spawnGoon","newGoon","PathFinder","reset","targetCell","getTarget","frontier","PriorityQueue","size","current","pop","adjacentCells","getAdjacentNeighbours","adjacentCell","distFromCurrent","diagonalCells","getDiagonalNeighbours","diagonalCell","currentCell","steps","higherPriorirtyFirst","data","value","priority","shouldComeFirst","priorityA","priorityB","ScoreBoard","containerEl","cashDisplay","querySelector","goonsInsideDisplay","waveNumberDisplay","messageDisplay","textContent","message","updateCash","updateGoonsInside","updateWaveNumber","Renderer","getContext","animationId","onclick","onCanvasClick","bind","onmousemove","onMouseMove","onmouseout","lastTick","requestAnimationFrame","tick","render","clearRect","_paintBoundaries","draw","drawGrid","blockedCells","getCells","getBoundaries","event","clientX","offsetLeft","clientY","offsetTop","onUserClick","w","h","document","getElementById","initDebugPanel","e","stopPropagation","preventDefault","parseInt","pauseResume"],"mappings":"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","file":"game.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 20);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d0314ad734240342be90","/**\n * @typedef {Object} Point\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n */\n\nimport Grid from './grid'\nimport Tower from './tower'\nimport GoonWave from './goon-wave'\nimport PathFinder from './path-finder'\nimport random from './utils/random'\nimport gameConfig from './game-config.js'\nimport ScoreBoard from './score-board.js'\nimport Renderer from './renderer.js'\n\nlet gameSingleton\n\nexport function initGame (canvas, scoreBoard) {\n  if (!gameSingleton) {\n    gameSingleton = new Game(canvas, scoreBoard)\n  }\n  return gameSingleton\n}\n\nexport function getGame () {\n  if (!gameSingleton) {\n    throw new Error('Game not initialized')\n  }\n  return gameSingleton\n}\n\nclass Game {\n  constructor (canvas, scoreBoard) {\n    this.canvas = canvas\n    this.scoreBoard = scoreBoard\n    this.towers = []\n    this.goons = []\n    this.bullets = []\n    this.highlight = undefined\n    this.spawnedGoonCount = 0\n    this.cash = gameConfig.initialCash\n    this.goonsInside = 0\n    this._isPaused = false\n  }\n\n  _init () {\n    this.grid = new Grid({width: 1000, height: 600})\n    this.pathFinder = new PathFinder(this.grid)\n    this.goonWave = new GoonWave()\n    this.scoreBoard = new ScoreBoard(this.scoreBoard)\n    this.renderer = new Renderer(this.canvas)\n    this.cellsWhereGoonCanSpawn = this.getCellsWhereGoonCanSpawn()\n    this.gameInitialized = true\n  }\n\n  start () {\n    if (!this.gameInitialized) {\n      this._init()\n    }\n    this.renderer.start()\n  }\n\n  stop () {\n    this.renderer.stop()\n  }\n\n  endGame (won) {\n    this.stop()\n    this.scoreBoard.updateMessage(won ? 'You won!' : 'You lost!')\n  }\n\n  onWavesEnd () {\n    this.wavesEnded = true\n  }\n\n  pauseResume () {\n    this._isPaused = !this._isPaused\n  }\n\n  /**\n   * When a user click a cell.\n   * @param  {Point} position - Cell upper-left position.\n   */\n  onUserClick (position) {\n    if (this.cash < Tower.cost) {\n      // no money, no tower\n      return\n    }\n    const towerCells = this.grid.getCellsAround(position, Tower.sizeInCells.rows, Tower.sizeInCells.cols)\n    // occupied ?\n    if (!towerCells || towerCells.some(cell => cell.blocked || cell.hasGoon)) {\n      return\n    }\n    // 1: block\n    towerCells.forEach(cell => { cell.blocked = true })\n    // 2: recalculate paths\n    this.pathFinder.recalculate()\n    // 3: check for trapped goons and spawn locations\n    const doNotTrapCells = this.goons.map(goon => goon.cell)\n      .concat(this.cellsWhereGoonCanSpawn)\n    const isInvalidPosition = doNotTrapCells.some(cell => !cell.reachable)\n    // 4: if trapped, rollback\n    if (isInvalidPosition) {\n      towerCells.forEach(cell => { cell.blocked = false })\n      this.pathFinder.recalculate()\n      return\n    }\n\n    const towerBoundaries = this._getCellsBoudaries(towerCells)\n    const tower = new Tower(towerBoundaries)\n    this.towers.push(tower)\n    this.cash -= Tower.cost\n  }\n\n  onMouseMove (position) {\n    this.mousePosition = position\n  }\n\n  updateHighlight () {\n    if (!this.mousePosition) {\n      return\n    }\n    const towerCells = this.grid.getCellsAround(\n      this.mousePosition,\n      Tower.sizeInCells.rows,\n      Tower.sizeInCells.cols\n    )\n    if (!towerCells) {\n      this.highlight = undefined\n      return\n    }\n    const towerBoundaries = this._getCellsBoudaries(towerCells)\n    const isOcuppied = towerCells.some(cell => cell.blocked || cell.hasGoon)\n    this.highlight = {\n      boundaries: towerBoundaries,\n      valid: !isOcuppied\n    }\n  }\n\n  /**\n   * Spawn a new goon.\n   */\n  spawnGoon (goon) {\n    const spawnCell = random.getRandomElementFromArray(this.cellsWhereGoonCanSpawn)\n    goon.setInitialCell(spawnCell)\n    this.goons.push(goon)\n  }\n\n  killGoon (goon) {\n    this.cash += goon.bounty\n    this.removeGoon(goon)\n  }\n\n  goonArrived (goon) {\n    this.goonsInside++\n    this.removeGoon(goon)\n\n    if (this.goonsInside >= 5) {\n      this.endGame(false)\n    }\n  }\n\n  removeGoon (goon) {\n    goon.cell.hasGoon = false\n    const index = this.goons.findIndex((aGoon) => aGoon.id === goon.id)\n    if (index >= 0) {\n      this.goons.splice(index, 1)\n    }\n    if (this.goons.length <= 0 && this.wavesEnded) {\n      this.endGame(true)\n    }\n  }\n\n  addBullet (bullet) {\n    this.bullets.push(bullet)\n  }\n\n  removeBullet (bullet) {\n    const index = this.bullets.findIndex((aBullet) => aBullet.id === bullet.id)\n    if (index >= 0) {\n      this.bullets.splice(index, 1)\n    }\n  }\n\n  /**\n   * Update the state of the game entities.\n   * @param  {number} delta - ms since last update.\n   */\n  update (delta) {\n    if (!this._isPaused) {\n      this.goonWave.update(delta)\n      this.towers.forEach((tower) => tower.update(delta))\n      this.goons.forEach((goon) => goon.update(delta))\n      this.bullets.forEach((bullet) => bullet.update(delta))\n    }\n    this.updateHighlight()\n    this.scoreBoard.update()\n  }\n\n  getCellsWhereGoonCanSpawn () {\n    const middle = Math.round(this.grid.rowCount / 2)\n    let count = Math.min(10, Math.round(this.grid.rowCount / 3))\n    let row = middle - Math.round(count / 2)\n    const cells = []\n    while (count-- > 0) {\n      cells.push(\n        this.grid.get(row++, 0)\n      )\n    }\n    return cells\n  }\n\n  _getCellsBoudaries (cells) {\n    return {\n      topLeft: cells[0].getTopLeftPosition(),\n      bottomRight: cells[cells.length - 1].getBottomRightPosition()\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/game.js","/* global Image */\n\n/**\n * List of images to load.\n * @type {Object}\n */\nconst imageUrls = {\n  'tower-1': '../images/tower-1.png',\n  'goon-1': '../images/goon-1.png',\n  'landscape_sheet': '../images/landscape_sheet.png',\n  'towers_grey_sheet': '../images/towers_grey_sheet.png'\n}\n\n/**\n * Global image cache.\n * @type {Object}\n */\nexport const imageCache = {}\n\n/**\n * Load the images on the cache and call the callback when ready.\n * @param  {function} onLoadComplete\n */\nexport function loadImageCache (onLoadComplete) {\n  for (let key in imageUrls) {\n    let url = imageUrls[key]\n    let img = new Image()\n    img.onload = () => {\n      imageCache[key] = img\n      if (Object.keys(imageCache).length === Object.keys(imageUrls).length) {\n        onLoadComplete()\n      }\n    }\n    img.src = url\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/image-cache.js","/**\n * Calculate the distance between 2 points.\n * @param  {Point} pointA\n * @param  {Point} pointB\n * @return {number} distance\n */\nexport const calculateDistance = (pointA, pointB) => {\n  const dx = pointB.x - pointA.x\n  const dy = pointB.y - pointA.y\n  return Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2))\n}\n\n/**\n * Let L be the line formed by the 2 given points `origin` and `anyPointInLine`.\n * Return the point in L with the given distance to `origin`.\n * @param  {Point} origin - Origin point.\n * @param  {Point} secondPointInLine - Another point in the desired line (define direction).\n * @param  {number} distance - Distance from origin to the returned point in pixels.\n * @param  {boolean} maxOnSecondPoint - If true, returns the second point if the result is beyond it in the line..\n * @return {Point} Point in L with the given distance to `origin`.\n */\nexport const getPointInLine = (origin, secondPointInLine, distance, maxOnSecondPoint = false) => {\n  const hyp = calculateDistance(origin, secondPointInLine)\n  const dx = secondPointInLine.x - origin.x\n  const dy = secondPointInLine.y - origin.y\n  const sin = dy / hyp\n  const cos = dx / hyp\n\n  let dyStep = sin * distance\n  let dxStep = cos * distance\n\n  if (maxOnSecondPoint) {\n    if (Math.abs(dxStep) > Math.abs(dx)) {\n      dxStep = dx\n    }\n    if (Math.abs(dyStep) > Math.abs(dy)) {\n      dyStep = dy\n    }\n  }\n  const nextX = origin.x + dxStep\n  const nextY = origin.y + dyStep\n  return {x: nextX, y: nextY}\n}\n\n/**\n * Return the angle between the line conecting 2 points and the horizontal axis.\n *\n * Angle signal:\n *  B     |     B\n *    (-) | (-)\n * -------A-------\n *    (+) | (+)\n *  B     |     B\n *\n * @param  {Point} pointA\n * @param  {Point} pointB\n * @return {number} Angle in radians.\n */\nexport const getAngleRadians = (pointA, pointB) => {\n  const dy = pointB.y - pointA.y\n  const hyp = calculateDistance(pointA, pointB)\n  const sin = dy / hyp\n  return Math.asin(sin)\n}\n\n/**\n * Check is two points are in the same position given th tolerance.\n * @param  {Point} pointA\n * @param  {Point} pointB\n * @param  {number} tolerance\n * @return {boolean}\n */\nexport const isEqualPoints = (pointA, pointB, tolerance = 1) => {\n  return Math.abs(pointA.x - pointB.x) <= tolerance &&\n    Math.abs(pointA.y - pointB.y) <= tolerance\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/geometry-utils.js","/* global Path2D */\n\n/**\n * @typedef {Object} Point\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n */\n\n/**\n * Build a square path.\n * @param  {Point} startPosition\n * @param  {number} edgeSize\n * @return {Path2D}\n */\nexport function buildSquarePath (startPosition, edgeSize) {\n  const path = new Path2D()\n  const startCorner = [startPosition.x, startPosition.y]\n  const corners = [\n    [startPosition.x + edgeSize, startPosition.y],\n    [startPosition.x + edgeSize, startPosition.y + edgeSize],\n    [startPosition.x, startPosition.y + edgeSize],\n    [startPosition.x, startPosition.y]\n  ]\n  path.moveTo(...startCorner)\n  corners.forEach((corner) => {\n    path.lineTo(...corner)\n  })\n  return path\n}\n\n/**\n * Draws a rounded rectangle using the current state of the canvas.\n * If you omit the last three params, it will draw a rectangle\n * outline with a 5 pixel border radius\n * @param {CanvasRenderingContext2D} ctx\n * @param {Number} x The top left x coordinate\n * @param {Number} y The top left y coordinate\n * @param {Number} width The width of the rectangle\n * @param {Number} height The height of the rectangle\n * @param {Boolean} [fill = false] Whether to fill the rectangle.\n * @param {Boolean} [stroke = true] Whether to stroke the rectangle.\n * @param {Number} [radius = 5] The corner radius; It can also be an object\n *                 to specify different radii for corners\n * @param {Number} [radius.tl = 0] Top left\n * @param {Number} [radius.tr = 0] Top right\n * @param {Number} [radius.br = 0] Bottom right\n * @param {Number} [radius.bl = 0] Bottom left\n */\nexport function roundRect (ctx, x, y, width, height, fill, stroke, radius) {\n  if (typeof stroke === 'undefined') {\n    stroke = true\n  }\n  if (typeof radius === 'undefined') {\n    radius = 5\n  }\n  if (typeof radius === 'number') {\n    radius = {tl: radius, tr: radius, br: radius, bl: radius}\n  } else {\n    const defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0}\n    for (var side in defaultRadius) {\n      radius[side] = radius[side] || defaultRadius[side]\n    }\n  }\n  ctx.beginPath()\n  ctx.moveTo(x + radius.tl, y)\n  ctx.lineTo(x + width - radius.tr, y)\n  ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr)\n  ctx.lineTo(x + width, y + height - radius.br)\n  ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height)\n  ctx.lineTo(x + radius.bl, y + height)\n  ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl)\n  ctx.lineTo(x, y + radius.tl)\n  ctx.quadraticCurveTo(x, y, x + radius.tl, y)\n  ctx.closePath()\n  if (fill) {\n    ctx.fill()\n  }\n  if (stroke) {\n    ctx.stroke()\n  }\n}\n\nexport function circle (ctx, x, y, radius, fill, stroke) {\n  ctx.beginPath()\n  ctx.arc(x, y, radius, 0, 2 * Math.PI)\n  fill && ctx.fill()\n  stroke && ctx.stroke()\n}\n\nexport function polygon (ctx, corners, fill, stroke) {\n  ctx.beginPath()\n  ctx.moveTo(corners[0].x, corners[0].y)\n  for (let corner of corners) {\n    ctx.lineTo(corner.x, corner.y)\n  }\n  ctx.closePath()\n  fill && ctx.fill()\n  stroke && ctx.stroke()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/drawing-utils.js","/**\n * @typedef {Object} Point\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n */\n\nimport Coord from './coord'\n\n/**\n * Size of the (square) cell edge.\n * @type {number}\n */\nexport const CELL_EDGE_SIZE = 20\n\n/**\n * Grid cell.\n */\nexport class Cell {\n  /**\n   * @param {number} row - Row number.\n   * @param {number} col - Column number.\n   */\n  constructor (row, col) {\n    this.coord = new Coord(row, col)\n    this.reachable = false\n    this.dist = undefined\n    this.nextStep = undefined\n    this.blocked = false\n    this.isTarget = false\n  }\n\n  /**\n   * Check cell coordinates.\n   * @param {Coord} coord\n   * @return {Boolean}\n   */\n  isOnCoord (coord) {\n    return this.coord.equals(coord)\n  }\n\n  /**\n   * Get the position of the center of the cell in pixels.\n   * @return {Point}\n   */\n  getCenterPosition () {\n    let x = Math.round((this.coord.col * CELL_EDGE_SIZE) + (CELL_EDGE_SIZE / 2))\n    let y = Math.round((this.coord.row * CELL_EDGE_SIZE) + (CELL_EDGE_SIZE / 2))\n    return {x, y}\n  }\n\n  /**\n   * Get the top-left position of the cell in pixels.\n   * @return {Point}\n   */\n  getTopLeftPosition () {\n    let x = this.coord.col * CELL_EDGE_SIZE\n    let y = this.coord.row * CELL_EDGE_SIZE\n    return {x, y}\n  }\n\n  /**\n   * Get the bottom-right position of the cell in pixels.\n   * @return {Point}\n   */\n  getBottomRightPosition () {\n    let x = (this.coord.col + 1) * CELL_EDGE_SIZE\n    let y = (this.coord.row + 1) * CELL_EDGE_SIZE\n    return {x, y}\n  }\n\n  /**\n   * Get the offset of a point inside the cell from the cell's top-left corner.\n   * @param  {Point} pointInCell\n   * @return {Point} offset\n   */\n  getOffset (pointInCell) {\n    const zero = this.getTopLeftPosition()\n    return {\n      x: pointInCell.x - zero.x,\n      y: pointInCell.y - zero.y\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cell.js","export default {\n  initialCash: 50,\n  waves: [\n    {\n      intervalAfterWave: 20000,\n      numberOfGoons: 5,\n      intervalBetweenSpawns: 1500,\n      goonSpeed: 20,\n      goonLife: 100,\n      goonBounty: 20\n    },\n    {\n      intervalAfterWave: 20000,\n      numberOfGoons: 10,\n      intervalBetweenSpawns: 1500,\n      goonSpeed: 20,\n      goonLife: 100,\n      goonBounty: 20\n    },\n    {\n      intervalAfterWave: 20000,\n      numberOfGoons: 10,\n      intervalBetweenSpawns: 1500,\n      goonSpeed: 25,\n      goonLife: 120,\n      goonBounty: 20\n    },\n    {\n      intervalAfterWave: 20000,\n      numberOfGoons: 10,\n      intervalBetweenSpawns: 1000,\n      goonSpeed: 25,\n      goonLife: 120,\n      goonBounty: 20\n    }\n  ]\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/game-config.js","import {imageCache} from './image-cache.js'\nimport {getPointInLine} from './geometry-utils'\nimport {getGame} from './game.js'\n\nconst GOON_IMAGE_SIZE = {\n  width: 14,\n  height: 20\n}\n\nexport default class Goon {\n  constructor (id, speed, life, bounty) {\n    this.id = id\n    this.game = getGame()\n    this.pathFinder = this.game.pathFinder\n    this.speed = speed // px/sec\n    this.fullLife = life\n    this.life = life\n    this.bounty = bounty\n\n    // store the decimals lost in the last step to maintain constant speed\n    this._residualStep = 0\n  }\n\n  setInitialCell (cell) {\n    this.cell = cell\n    this.cell.hasGoon = true\n    this.position = this.cell.getTopLeftPosition()\n  }\n\n  /**\n   * Draw the goon on position.\n   * @param  {CanvasRenderingContext2D} context - Canvas renderering context.\n   */\n  draw (context) {\n    // _Paint cell base:\n    // context.fillStyle = 'gold'\n    // const cellOrigin = this.cell.getTopLeftPosition()\n    // context.fillRect(cellOrigin.x, cellOrigin.y, CELL_EDGE_SIZE, CELL_EDGE_SIZE)\n\n    const img = imageCache['goon-1']\n    context.drawImage(img, this.position.x, this.position.y - Math.round(GOON_IMAGE_SIZE.height / 2))\n    this.drawLifeBar(context)\n  }\n\n  drawLifeBar (context) {\n    const height = 4\n    const width = 20\n    const greenWidth = Math.max(0, Math.round(width * this.life / this.fullLife))\n    const redWidth = width - greenWidth\n\n    const y = this.position.y - width\n    const greenX = this.position.x\n    const redX = this.position.x + greenWidth\n\n    context.fillStyle = 'green'\n    context.fillRect(greenX, y, greenWidth, height)\n    context.fillStyle = 'red'\n    context.fillRect(redX, y, redWidth, height)\n  }\n\n  /**\n   * Update goon state.\n   * @param  {number} delta - ms since last update.\n   */\n  update (delta) {\n    this.updatePosition(delta)\n    this.updateLife(delta)\n  }\n\n  updateLife (delta) {\n    if (this.life <= 0) {\n      this.game.killGoon(this)\n    }\n  }\n\n  updatePosition (delta) {\n    this.cell.hasGoon = false\n    const nextCell = this.pathFinder.nextCell(this.cell, 1)\n    if (!nextCell) {\n      throw new Error('Goon traped!')\n    }\n\n    // TODO: this logic is obscure, rewrite it\n    const offset = this.cell.getOffset(this.position)\n    const targetPosition = {\n      x: nextCell.getTopLeftPosition().x + offset.x,\n      y: nextCell.getTopLeftPosition().y + offset.y\n    }\n\n    const step = (this.speed * delta / 1000.0) + this._residualStep\n    const intStep = Math.floor(step)\n    this._residualStep = step - intStep\n\n    const nextPosition = getPointInLine(this.position, targetPosition, intStep)\n    // Might happen that step is not enought to change cell\n    let nextPositionCell = this.game.grid.getCellAtPosition(nextPosition)\n\n    // TODO: this is a hack to fix diagonal moves that passes through blocked cells. Rewrite it in a sane way.\n    if (nextPositionCell.blocked) {\n      nextPositionCell = this.cell\n    }\n\n    if (nextPositionCell.isTarget) {\n      this.game.goonArrived(this)\n    } else {\n      this.cell = nextPositionCell\n      this.cell.hasGoon = true\n      this.position = nextPosition\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/goon.js","class Random {\n  yesOrNo (yesChance) {\n    yesChance = yesChance || 0.5\n    return Math.random() < yesChance\n  }\n\n  getRandomIntExclusive (min, max) {\n    min = Math.ceil(min)\n    max = Math.floor(max)\n    // The maximum is exclusive and the minimum is inclusive\n    return Math.floor(Math.random() * (max - min)) + min\n  }\n\n  getRandomIntInclusive (min, max) {\n    min = Math.ceil(min)\n    max = Math.floor(max)\n    // The maximum is inclusive and the minimum is inclusive\n    return Math.floor(Math.random() * (max - min + 1)) + min\n  }\n\n  getRandomElementFromArray (array) {\n    var index = this.getRandomIntExclusive(0, array.length)\n    return array[index]\n  }\n\n  shuffle (array) {\n    let currentIndex = array.length\n    let temporaryValue, randomIndex\n\n    // While there remain elements to shuffle...\n    while (currentIndex !== 0) {\n      // Pick a remaining element...\n      randomIndex = Math.floor(Math.random() * currentIndex)\n      currentIndex -= 1\n\n      // And swap it with the current element.\n      temporaryValue = array[currentIndex]\n      array[currentIndex] = array[randomIndex]\n      array[randomIndex] = temporaryValue\n    }\n  }\n}\n\nexport default new Random()\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/random.js","/**\n * @typedef {Object} CellData\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n * @property {number} dist - Number of steps until target.\n * @property {number} nextStep - Next cell on the path to target.\n */\n\nimport {Cell, CELL_EDGE_SIZE} from './cell'\n\nexport default class Grid {\n  constructor (canvasSize) {\n    this.canvasSize = canvasSize\n    this.colCount = Math.floor(canvasSize.width / CELL_EDGE_SIZE)\n    this.rowCount = Math.floor(canvasSize.height / CELL_EDGE_SIZE)\n    this.init()\n  }\n\n  init () {\n    this.grid = new Array(this.rowCount)\n    for (var row = 0; row < this.rowCount; row++) {\n      this.grid[row] = Array(this.colCount)\n      for (var col = 0; col < this.colCount; col++) {\n        this.grid[row][col] = new Cell(row, col)\n      }\n    }\n    // flatten all cells on a single array\n    this.allCells = [].concat.apply([], this.grid)\n  }\n\n  /**\n   * Reset grid data.\n   */\n  reset () {\n    for (var row = 0; row < this.rowCount; row++) {\n      for (var col = 0; col < this.colCount; col++) {\n        this.grid[row][col].reachable = false\n        this.grid[row][col].dist = undefined\n        this.grid[row][col].nextStep = undefined\n      }\n    }\n  }\n\n  /**\n   * Get cell at position.\n   * @param  {number} x - X coordinate.\n   * @param  {number} y - Y coordinate.\n   * @return {Cell}\n   */\n  get (row, col) {\n    try {\n      return this.grid[row][col]\n    } catch (any) {\n      return undefined\n    }\n  }\n\n  /**\n   * Get target cell.\n   * @return {Cell}\n   */\n  getTarget () {\n    let row = Math.round(this.rowCount / 2)\n    let col = this.colCount - 1\n    return this.get(row, col)\n  }\n\n  /**\n   * Get the unvisited neighbour cells of the position.\n   * @param  {Cell} cell\n   * @return {Cell[]}\n   */\n  getUnvisitedNeighboursCells (cell) {\n    const coord = cell.coord\n    const grid = this\n    return [\n      {row: coord.row, col: coord.col - 1},\n      {row: coord.row - 1, col: coord.col},\n      {row: coord.row, col: coord.col + 1},\n      {row: coord.row + 1, col: coord.col}\n    ].filter(coord => (\n      !this._isOutOfGrid(coord)\n    )).map(coord => (\n      grid.get(coord.row, coord.col)\n    )).filter(cell => (\n      cell.dist === undefined &&\n      !cell.blocked\n    ))\n  }\n\n  getAdjacentNeighbours (cell) {\n    const coord = cell.coord\n    const grid = this\n    return [\n      {row: coord.row, col: coord.col - 1},\n      {row: coord.row - 1, col: coord.col},\n      {row: coord.row, col: coord.col + 1},\n      {row: coord.row + 1, col: coord.col}\n    ].filter(coord => (\n      !this._isOutOfGrid(coord)\n    )).map(coord => (\n      grid.get(coord.row, coord.col)\n    )).filter(cell => (\n      !cell.blocked\n    ))\n  }\n\n  getDiagonalNeighbours (cell) {\n    const coord = cell.coord\n    const grid = this\n    return [\n      {row: coord.row - 1, col: coord.col - 1},\n      {row: coord.row - 1, col: coord.col + 1},\n      {row: coord.row + 1, col: coord.col + 1},\n      {row: coord.row + 1, col: coord.col - 1}\n    ].filter(coord => (\n      !this._isOutOfGrid(coord)\n    )).map(coord => (\n      grid.get(coord.row, coord.col)\n    )).filter(cell => (\n      !cell.blocked\n    ))\n  }\n\n  /**\n   * Get the cell that contains the provided position.\n   * @param  {Point} point\n   * @return {Cell}\n   */\n  getCellAtPosition (point) {\n    if (point.x < 0 ||\n      point.x > this.canvasSize.width ||\n      point.y < 0 ||\n      point.y > this.canvasSize.height\n    ) {\n      return undefined\n    }\n    const col = Math.floor(point.x / CELL_EDGE_SIZE)\n    const row = Math.floor(point.y / CELL_EDGE_SIZE)\n    return this.get(row, col)\n  }\n\n  /**\n   * Get the cells that contains the boundaries area.\n   * @param  {Boundaries} boundaries\n   * @return {Cell[]}\n   */\n  getCellsInBoundaries (boundaries) {\n    const topLeftCell = this.getCellAtPosition(boundaries.topLeft)\n    const bottomRightCell = this.getCellAtPosition(boundaries.bottomRight)\n    const cells = []\n    for (let row = topLeftCell.coord.row; row <= bottomRightCell.coord.row; row++) {\n      for (let col = topLeftCell.coord.col; col <= bottomRightCell.coord.col; col++) {\n        cells.push(this.get(row, col))\n      }\n    }\n    return cells\n  }\n\n  /**\n   * Return an array containing all cells.\n   * @return {Cell[]}\n   */\n  getCells () {\n    return this.allCells\n  }\n\n  /**\n   * Return a block of cells containg the point approximately in the center\n   * @param  {Point} point - Point contained in the block,\n   * @param  {number} rowCount - Number of rows in the block.\n   * @param  {number} colCount - Number of cols in the block.\n   * @return {Cell[]}\n   */\n  getCellsAround (point, rowCount, colCount) {\n    const center = this.getCellAtPosition(point)\n    if (!center) {\n      return undefined\n    }\n    const topRow = center.coord.row - Math.floor(rowCount / 2)\n    const bottomRow = topRow + rowCount - 1\n    const leftCol = center.coord.col - Math.floor(colCount / 2)\n    const rightCol = leftCol + colCount - 1\n    if (this._isOutOfGrid({row: topRow, col: leftCol}) ||\n      this._isOutOfGrid({row: bottomRow, col: rightCol})) {\n      return undefined\n    }\n\n    const cells = []\n    for (let row = topRow; row <= bottomRow; row++) {\n      for (let col = leftCol; col <= rightCol; col++) {\n        cells.push(this.get(row, col))\n      }\n    }\n    return cells\n  }\n\n  /**\n   * Check if a coordinate is out of the grid.\n   * @param  {Coord} coord\n   * @return {Boolean}       [description]\n   */\n  _isOutOfGrid (coord) {\n    return coord.col < 0 ||\n      coord.col >= this.colCount ||\n      coord.row < 0 ||\n      coord.row >= this.rowCount\n  }\n\n  draw (context) {\n    context.strokeStyle = '#333333'\n    for (var row = 0; row < this.rowCount; row++) {\n      for (var col = 0; col < this.colCount; col++) {\n        let cell = this.get(row, col)\n        if (cell.isTarget) {\n          context.fillStyle = 'rgba(0, 0, 255, 0.7)'\n          context.fillRect(cell.getTopLeftPosition().x, cell.getTopLeftPosition().y, CELL_EDGE_SIZE, CELL_EDGE_SIZE)\n        } else if (cell.blocked) {\n          context.fillStyle = 'rgba(255, 118, 0, 0.7)'\n          context.fillRect(cell.getTopLeftPosition().x, cell.getTopLeftPosition().y, CELL_EDGE_SIZE, CELL_EDGE_SIZE)\n        } else if (!cell.reachable) {\n          context.fillStyle = 'rgba(255, 0, 0, 0.37)'\n          context.fillRect(cell.getTopLeftPosition().x, cell.getTopLeftPosition().y, CELL_EDGE_SIZE, CELL_EDGE_SIZE)\n        }\n        context.strokeRect(cell.getTopLeftPosition().x, cell.getTopLeftPosition().y, CELL_EDGE_SIZE, CELL_EDGE_SIZE)\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/grid.js","export default class Coord {\n  /**\n   * @param {number} row\n   * @param {number} col\n   */\n  constructor (row, col) {\n    this.row = row\n    this.col = col\n  }\n\n  /**\n   * Compare two coordinates.\n   * @param {Coord} coord\n   * @return {Boolean}\n   */\n  equals (coord) {\n    return coord && this.row === coord.row && this.col === coord.col\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/coord.js","import {calculateDistance, getAngleRadians} from './geometry-utils'\nimport {roundRect, circle} from './drawing-utils'\nimport {getGame} from './game.js'\nimport Bullet from './bullet.js'\n/**\n * @typedef {Object} Point\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n */\n\n/**\n * @typedef {Object} Boundaries\n * @property {Point} topLeft - top-left point of the object.\n * @property {Point} bottomRight - bottom-right point of the object.\n */\n\nexport default class Tower {\n  constructor (boundaries) {\n    this.game = getGame()\n    this.topLeftPosition = boundaries.topLeft\n    this.width = boundaries.bottomRight.x - boundaries.topLeft.x\n    this.height = boundaries.bottomRight.y - boundaries.topLeft.y\n    this.centerPosition = {\n      x: Math.round(boundaries.topLeft.x + (this.width / 2)),\n      y: Math.round(boundaries.topLeft.y + (this.height / 2))\n    }\n    // shooting consts\n    this.reloadTime = 2000\n    this.fireRange = 150\n    this.damage = 5\n\n    // shoting props\n    this.timeUntilReloaded = 0\n    this.canonAngle = Math.PI\n  }\n\n  /**\n   * Draw the tower on position.\n   * @param  {CanvasRenderingContext2D} context - Canvas renderering context.\n   */\n  draw (context) {\n    // grass\n    let x = this.topLeftPosition.x\n    let y = this.topLeftPosition.y\n    let width = this.width\n    let height = this.height\n    context.fillStyle = '#B8E986'\n    context.strokeStyle = '#7ED321'\n    roundRect(context, x, y, width, height, true, true)\n\n    // base\n    const basePct = 3 / 5\n    const baseWidth = Math.round(width * basePct)\n    const baseHeight = Math.round(height * basePct)\n    const baseX = x + Math.round((width - baseWidth) / 2)\n    const baseY = y + Math.round((height - baseHeight) / 2)\n    context.fillStyle = '#D3D3D3'\n    context.strokeStyle = '#979797'\n    context.fillRect(baseX, baseY, baseWidth, baseHeight)\n    context.strokeRect(baseX, baseY, baseWidth, baseHeight)\n\n    // Rotatory device\n    const rotPct = 2 / 5\n    const rotRadius = Math.round(width * rotPct / 2)\n    const rotCenterX = x + Math.round(width / 2)\n    const rotCenterY = y + Math.round(height / 2)\n    context.fillStyle = '#9B9B9B'\n    context.strokeStyle = '#979797'\n    circle(context, rotCenterX, rotCenterY, rotRadius, true, true)\n\n    // canon\n    const canonPct = 22 / 50\n    const canonWidth = Math.round(width * canonPct)\n    const canonHeight = 8\n    const canonX = 0\n    const canonY = 0 - Math.round(canonHeight / 2)\n    context.save()\n    context.translate(rotCenterX, rotCenterY)\n    context.rotate(this.canonAngle)\n    context.fillStyle = '#9B9B9B'\n    context.strokeStyle = '#979797'\n    context.fillRect(canonX, canonY, canonWidth, canonHeight)\n    context.restore()\n  }\n\n  /**\n   * Update tower state.\n   * @param  {number} delta - ms since last update.\n   */\n  update (delta) {\n    if (this.isLoaded()) {\n      this.shoot()\n    } else {\n      this.reload(delta)\n    }\n  }\n\n  reload (delta) {\n    this.timeUntilReloaded -= delta\n  }\n\n  shoot () {\n    const goon = this.getClosestGoonInRange()\n    if (goon) {\n      this.game.addBullet(new Bullet(this.centerPosition, goon))\n      goon.life -= this.damage\n      this.timeUntilReloaded = this.reloadTime\n      this.canonAngle = getAngleRadians(this.centerPosition, goon.position)\n      if (goon.position.x < this.centerPosition.x) {\n        this.canonAngle = Math.PI - this.canonAngle\n      }\n    }\n  }\n\n  isLoaded () {\n    return this.timeUntilReloaded <= 0\n  }\n\n  getClosestGoonInRange () {\n    let towerCenter = this.centerPosition\n    const goonsInRange = this.game.goons\n      .map(goon => {\n        const dist = calculateDistance(towerCenter, goon.position)\n        return {goon, dist}\n      })\n      .filter(goonDist => goonDist.dist <= this.fireRange)\n      .sort((a, b) => a.dist - b.dist)\n    return goonsInRange.length > 0 ? goonsInRange[0].goon : undefined\n  }\n\n  /**\n   * Get to top-left and bottom-right points of the tower.\n   * @return {Boundaries}\n   */\n  getBoundaries () {\n    return {\n      'topLeft': this.topLeftPosition,\n      'bottomRight': this.bottomRightPosition\n    }\n  }\n}\nTower.cost = 10\nTower.sizeInCells = {\n  rows: 2,\n  cols: 2\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/tower.js","import {getPointInLine, isEqualPoints} from './geometry-utils'\nimport {circle} from './drawing-utils'\nimport {getGame} from './game.js'\n\nconst SPEED = 200\nconst RADIUS = 2\n\nexport default class Bullet {\n  constructor (initialPosition, targetGoon) {\n    this.id = Date.now()\n    this.position = initialPosition\n    this.targetGoon = targetGoon\n    this.game = getGame()\n  }\n\n  update (delta) {\n    const step = Math.round(SPEED * delta / 1000.0)\n    const target = this.targetGoon.position\n    this.position = getPointInLine(this.position, target, step, true)\n    if (isEqualPoints(target, this.position)) {\n      this.game.removeBullet(this)\n    }\n  }\n\n  draw (context) {\n    context.fillStyle = '#525252'\n    circle(context, this.position.x, this.position.y, RADIUS, true, false)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/bullet.js","import Goon from './goon'\nimport gameConfig from './game-config.js'\nimport {getGame} from './game.js'\n\nexport default class GoonWave {\n  constructor () {\n    this.game = getGame()\n    this.config = gameConfig.waves.slice(0)\n\n    this.currentWave = null\n    this.waveNumber = 0\n    this.timeUntilNexWave = 0\n    this.timeUntilNextSpawn = 0\n    this.goonsLeft = 0\n  }\n\n  update (delta) {\n    this.startOrStopWave(delta)\n    this.deployGoons(delta)\n  }\n\n  startOrStopWave (delta) {\n    if (this.currentWave) {\n      // no more goons, end wave\n      if (this.goonsLeft === 0) {\n        this.timeUntilNexWave = this.currentWave.intervalAfterWave\n        this.currentWave = null\n      }\n    } else {\n      this.timeUntilNexWave -= delta\n      // interval ended, start wave\n      if (this.timeUntilNexWave <= 0) {\n        if (this.config.length === 0) {\n          this.game.onWavesEnd()\n          return\n        }\n        this.currentWave = this.config.shift()\n        this.waveNumber++\n        this.timeUntilNextSpawn = this.currentWave.intervalBetweenSpawns\n        this.goonsLeft = this.currentWave.numberOfGoons\n      }\n    }\n  }\n\n  deployGoons (delta) {\n    // is wave running?\n    if (!this.currentWave || this.goonsLeft === 0) {\n      return\n    }\n    // is in interval between spawns? wait...\n    if (this.timeUntilNextSpawn > 0) {\n      this.timeUntilNextSpawn -= delta\n      return\n    }\n\n    // spawn!\n    this.timeUntilNextSpawn = this.currentWave.intervalBetweenSpawns\n    this.goonsLeft--\n    this.game.spawnGoon(this.newGoon())\n  }\n\n  newGoon () {\n    const id = Date.now()\n    const goon = new Goon(\n      id,\n      this.currentWave.goonSpeed,\n      this.currentWave.goonLife,\n      this.currentWave.goonBounty\n    )\n    return goon\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/goon-wave.js","export default class PathFinder {\n  constructor (grid) {\n    this.grid = grid\n    this.recalculate()\n  }\n\n  /**\n   * Recalculate all paths\n   */\n  recalculate () {\n    this.grid.reset()\n    let targetCell = this.grid.getTarget()\n    targetCell.dist = 0\n    targetCell.reachable = true\n    targetCell.isTarget = true\n    targetCell.nextStep = undefined\n    this.frontier = new PriorityQueue(false)\n    this.frontier.push(targetCell, targetCell.dist)\n\n    while (this.frontier.size() > 0) {\n      let current = this.frontier.pop()\n\n      // adjacent cells have cost of 1\n      let adjacentCells = this.grid.getAdjacentNeighbours(current)\n      for (let adjacentCell of adjacentCells) {\n        let distFromCurrent = current.dist + 1\n        if (adjacentCell.dist === undefined || adjacentCell.dist > distFromCurrent) {\n          adjacentCell.dist = distFromCurrent\n          adjacentCell.reachable = true\n          adjacentCell.nextStep = current\n          this.frontier.push(adjacentCell, distFromCurrent)\n        }\n      }\n\n      // diagonal cells have cost of 1.5\n      let diagonalCells = this.grid.getDiagonalNeighbours(current)\n      for (let diagonalCell of diagonalCells) {\n        let distFromCurrent = current.dist + 1.5\n        if (diagonalCell.dist === undefined || diagonalCell.dist > distFromCurrent) {\n          diagonalCell.dist = distFromCurrent\n          diagonalCell.reachable = true\n          diagonalCell.nextStep = current\n          this.frontier.push(diagonalCell, distFromCurrent)\n        }\n      }\n    }\n  }\n\n  /**\n   * Get the next position in the path to the target.\n   * @param  {Point} currentPosition - Current position.\n   * @param  {Number} steps - Number of steps to perform.\n   * @return {Point}\n   */\n  nextCell (currentCell, steps = 1) {\n    let nextCell = currentCell.nextStep\n    while (--steps > 0 && nextCell) {\n      nextCell = nextCell.nextStep\n    }\n    return nextCell\n  }\n}\n\nclass PriorityQueue {\n  constructor (higherPriorirtyFirst = true) {\n    this.data = []\n    this.higherPriorirtyFirst = higherPriorirtyFirst\n  }\n\n  push (value, priority) {\n    let index = 0\n    while (\n      this.data.length > index &&\n      !this.shouldComeFirst(priority, this.data[index].priority)\n    ) {\n      index++\n    }\n    this.data.splice(index, 0, {value: value, priority: priority})\n  }\n\n  pop () {\n    return this.data.shift().value\n  }\n\n  size () {\n    return this.data.length\n  }\n\n  shouldComeFirst (priorityA, priorityB) {\n    return this.higherPriorirtyFirst ? priorityA > priorityB : priorityB > priorityA\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/path-finder.js","import {getGame} from './game.js'\n\nexport default class ScoreBoard {\n  constructor (containerEl) {\n    this.game = getGame()\n    this.cashDisplay = containerEl.querySelector('#cashDisplay')\n    this.goonsInsideDisplay = containerEl.querySelector('#goonsInsideDisplay')\n    this.waveNumberDisplay = containerEl.querySelector('#waveNumberDisplay')\n    this.messageDisplay = containerEl.querySelector('#messageDisplay')\n    this.update()\n  }\n\n  updateCash (cash) {\n    if (this.cash !== cash) {\n      this.cash = cash\n      this.cashDisplay.textContent = cash\n    }\n  }\n\n  updateGoonsInside (goonsInside) {\n    if (this.goonsInside !== goonsInside) {\n      this.goonsInside = goonsInside\n      this.goonsInsideDisplay.textContent = goonsInside\n    }\n  }\n\n  updateWaveNumber (waveNumber) {\n    if (this.waveNumber !== waveNumber) {\n      this.waveNumber = waveNumber\n      this.waveNumberDisplay.textContent = waveNumber\n    }\n  }\n\n  updateMessage (message) {\n    this.messageDisplay.textContent = message\n  }\n\n  update () {\n    this.updateCash(this.game.cash)\n    this.updateGoonsInside(this.game.goonsInside)\n    this.updateWaveNumber(this.game.goonWave.waveNumber)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/score-board.js","/* global requestAnimationFrame */\nimport {getGame} from './game.js'\n\n/**\n * @typedef {Object} Point\n * @property {number} x - The X Coordinate.\n * @property {number} y - The Y Coordinate.\n */\n\nimport {CELL_EDGE_SIZE} from './cell'\n\nclass Renderer {\n  /**\n   * Grid constructor\n   * @param  {Game} game - Main game controller.\n   * @param  {HTMLCanvasElement} canvas - HTML canvas.\n   */\n  constructor (canvas) {\n    this.canvas = canvas\n    this.game = getGame()\n    this.canvas.width = this.game.grid.canvasSize.width\n    this.canvas.height = this.game.grid.canvasSize.height\n    this.context = this.canvas.getContext('2d')\n    this.animationId = null\n\n    // bind events\n    this.canvas.onclick = this.onCanvasClick.bind(this)\n    this.canvas.onmousemove = this.onMouseMove.bind(this)\n    this.canvas.onmouseout = this.onMouseMove.bind(this)\n  }\n\n  /**\n   * Start the game loop.\n   */\n  start () {\n    this.lastTick = Date.now()\n    this.animationId = requestAnimationFrame(this.tick.bind(this))\n  }\n\n  stop () {\n    this.animationId = null\n  }\n\n  isRunning () {\n    return this.animationId !== null\n  }\n\n  /**\n   * Update state, render and restart the game loop every X ms.\n   */\n  tick () {\n    if (!this.animationId) {\n      return\n    }\n\n    const now = Date.now()\n    const delta = (now - this.lastTick)\n\n    this.game.update(delta)\n\n    if (!this.animationId) {\n      return\n    }\n    this.lastTick = now\n\n    this.render()\n    this.animationId = requestAnimationFrame(this.tick.bind(this))\n  }\n\n  /**\n   * Draw the grid.\n   */\n  render () {\n    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    // 0: highlight\n    if (this.game.highlight) {\n      let stroke = 'green'\n      let fill = 'lightgreen'\n      if (!this.game.highlight.valid) {\n        stroke = 'red'\n        fill = 'lightcoral'\n      }\n      this._paintBoundaries(this.game.highlight.boundaries, stroke, fill)\n    }\n\n    // TODO: Merge drawables\n\n    // 1st layer: towers\n    this.game.towers.forEach((tower) => {\n      tower.draw(this.context)\n    })\n\n    // 2nd layer: goons\n    this.game.goons.forEach((goon) => {\n      goon.draw(this.context)\n    })\n\n    // 3rd layer: bullets\n    this.game.bullets.forEach((bullet) => {\n      bullet.draw(this.context)\n    })\n\n    if (this.game.drawGrid) {\n      this.game.grid.draw(this.context)\n    }\n  }\n\n  /**\n   * DEBUG: paint a blue square on blocked cells\n   */\n  paintBlockedCells () {\n    this.context.fillStyle = 'lightskyblue'\n    this.context.strokeStyle = 'azure'\n    const blockedCells = this.game.grid.getCells().filter((cell) => cell.blocked)\n    blockedCells.forEach((cell) => {\n      let position = cell.getTopLeftPosition()\n      this.context.strokeRect(position.x, position.y, CELL_EDGE_SIZE, CELL_EDGE_SIZE)\n      this.context.fillRect(position.x, position.y, CELL_EDGE_SIZE, CELL_EDGE_SIZE)\n    })\n\n    this.game.towers.forEach((tower) => {\n      this._paintBoundaries(tower.getBoundaries(), 'red')\n    })\n  }\n\n  /**\n   * Trigger onclick on canvas click.\n   * @param {MouseEvent} event\n   */\n  onCanvasClick (event) {\n    var mousePosition = {\n      x: event.clientX - event.target.offsetLeft,\n      y: event.clientY - event.target.offsetTop\n    }\n    this.game.onUserClick(mousePosition)\n  }\n\n  onMouseMove (event) {\n    var mousePosition = {\n      x: event.clientX - event.target.offsetLeft,\n      y: event.clientY - event.target.offsetTop\n    }\n    this.game.onMouseMove(mousePosition)\n  }\n\n  _paintBoundaries (boundaries, stroke, fill) {\n    let position = boundaries.topLeft\n    let w = boundaries.bottomRight.x - position.x\n    let h = boundaries.bottomRight.y - position.y\n    if (stroke) {\n      this.context.strokeStyle = stroke\n      this.context.strokeRect(position.x, position.y, w, h)\n    }\n    if (fill) {\n      this.context.fillStyle = fill\n      this.context.fillRect(position.x, position.y, w, h)\n    }\n  }\n}\n\nexport default Renderer\n\n\n\n// WEBPACK FOOTER //\n// ./src/renderer.js","import {loadImageCache} from './image-cache.js'\nimport {initGame, getGame} from './game.js'\n\nloadImageCache(init)\n\nfunction init () {\n  const canvas = document.getElementById('canvas')\n  const scoreBoard = document.getElementById('scoreBoard')\n\n  const game = initGame(canvas, scoreBoard)\n  game.start()\n\n  initDebugPanel()\n}\n\nfunction initDebugPanel () {\n  document.getElementById('spawn').onclick = function (e) {\n    e.stopPropagation()\n    e.preventDefault()\n\n    const x = parseInt(document.getElementById('x').value)\n    const y = parseInt(document.getElementById('y').value)\n    getGame().spawnGoon(x, y)\n  }\n\n  document.getElementById('speedUpdate').onclick = function (e) {\n    e.stopPropagation()\n    e.preventDefault()\n\n    const speed = parseInt(document.getElementById('speed').value)\n    getGame().goons.forEach(goon => { goon.speed = speed })\n  }\n\n  document.getElementById('pause').onclick = function (e) {\n    e.stopPropagation()\n    e.preventDefault()\n    getGame().pauseResume()\n  }\n\n  document.getElementById('drawGrid').onclick = function (e) {\n    e.stopPropagation()\n    e.preventDefault()\n    getGame().drawGrid = !getGame().drawGrid\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}